{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.iterator.reduce.js\";\nimport \"core-js/modules/es.set.difference.v2.js\";\nimport \"core-js/modules/es.set.intersection.v2.js\";\nimport \"core-js/modules/es.set.is-disjoint-from.v2.js\";\nimport \"core-js/modules/es.set.is-subset-of.v2.js\";\nimport \"core-js/modules/es.set.is-superset-of.v2.js\";\nimport \"core-js/modules/es.set.symmetric-difference.v2.js\";\nimport \"core-js/modules/es.set.union.v2.js\";\nimport { defineStore } from 'pinia';\nimport { ref, computed } from 'vue';\nimport { db } from '@/main';\nimport { doc, setDoc, getDoc } from 'firebase/firestore';\nimport { useUserStore } from './user';\nexport const useCartStore = defineStore('cart', () => {\n  const items = ref([]);\n  const loading = ref(false);\n  const itemsCount = computed(() => items.value.reduce((total, item) => total + (item.quantity || 0), 0));\n  const subtotal = computed(() => items.value.reduce((total, item) => total + (item.price || 0) * (item.quantity || 0), 0));\n  const tax = computed(() => subtotal.value * 0.08);\n  const shipping = computed(() => subtotal.value > 50 ? 0 : 10);\n  const total = computed(() => subtotal.value + tax.value + shipping.value);\n  const saveCartLocally = () => {\n    try {\n      localStorage.setItem('cart', JSON.stringify(items.value));\n    } catch (e) {\n      console.error('Error saving cart locally:', e);\n    }\n  };\n  const loadCart = async () => {\n    const userStore = useUserStore();\n\n    // Try to load from localStorage first\n    const localCart = localStorage.getItem('cart');\n    if (localCart) items.value = JSON.parse(localCart);\n\n    // If authenticated, sync with Firestore\n    if (userStore.isAuthenticated && userStore.user) {\n      try {\n        loading.value = true;\n        const cartDoc = await getDoc(doc(db, 'carts', userStore.user.uid));\n        if (cartDoc.exists()) {\n          items.value = cartDoc.data().items || [];\n          saveCartLocally();\n        }\n      } catch (error) {\n        console.error('Error loading cart from Firestore:', error);\n      } finally {\n        loading.value = false;\n      }\n    }\n  };\n  const saveCart = async () => {\n    const userStore = useUserStore();\n    // Save to localStorage first\n    saveCartLocally();\n\n    // Save to Firestore if authenticated\n    if (userStore.isAuthenticated && userStore.user) {\n      try {\n        await setDoc(doc(db, 'carts', userStore.user.uid), {\n          items: items.value,\n          updatedAt: new Date().toISOString()\n        });\n      } catch (error) {\n        console.error('Error saving cart to Firestore:', error);\n      }\n    }\n  };\n  const addItem = async product => {\n    const existingItem = items.value.find(item => item.id === product.id);\n    if (existingItem) {\n      existingItem.quantity = (existingItem.quantity || 0) + 1;\n    } else {\n      items.value.push({\n        id: product.id,\n        title: product.title,\n        price: product.price,\n        image: product.image,\n        quantity: 1,\n        category: product.category\n      });\n    }\n    saveCartLocally();\n    await saveCart();\n    await addToHistory(product);\n    return {\n      success: true\n    };\n  };\n  const updateQuantity = async (productId, quantity) => {\n    const item = items.value.find(item => item.id === productId);\n    if (item) {\n      if (quantity <= 0) {\n        await removeItem(productId);\n      } else {\n        item.quantity = quantity;\n        await saveCart();\n      }\n    }\n  };\n  const removeItem = async productId => {\n    const index = items.value.findIndex(item => item.id === productId);\n    if (index > -1) {\n      items.value.splice(index, 1);\n      await saveCart();\n    }\n  };\n  const clearCart = async () => {\n    items.value = [];\n    await saveCart();\n  };\n  const addToHistory = async product => {\n    const userStore = useUserStore();\n    if (!userStore.isAuthenticated || !userStore.user) return;\n    try {\n      const history = {\n        productId: product.id,\n        productTitle: product.title,\n        productPrice: product.price,\n        action: 'added_to_cart',\n        timestamp: new Date().toISOString(),\n        userId: userStore.user.uid\n      };\n      await setDoc(doc(db, 'history', `${userStore.user.uid}_${Date.now()}`), history);\n    } catch (error) {\n      console.error('Error adding to history:', error);\n    }\n  };\n  const getRecommendations = computed(() => {\n    const categories = [...new Set(items.value.map(item => item.category).filter(Boolean))];\n    return categories;\n  });\n  return {\n    items,\n    loading,\n    itemsCount,\n    subtotal,\n    tax,\n    shipping,\n    total,\n    loadCart,\n    addItem,\n    updateQuantity,\n    removeItem,\n    clearCart,\n    getRecommendations\n  };\n});","map":{"version":3,"names":["defineStore","ref","computed","db","doc","setDoc","getDoc","useUserStore","useCartStore","items","loading","itemsCount","value","reduce","total","item","quantity","subtotal","price","tax","shipping","saveCartLocally","localStorage","setItem","JSON","stringify","e","console","error","loadCart","userStore","localCart","getItem","parse","isAuthenticated","user","cartDoc","uid","exists","data","saveCart","updatedAt","Date","toISOString","addItem","product","existingItem","find","id","push","title","image","category","addToHistory","success","updateQuantity","productId","removeItem","index","findIndex","splice","clearCart","history","productTitle","productPrice","action","timestamp","userId","now","getRecommendations","categories","Set","map","filter","Boolean"],"sources":["C:/Users/veszi/Desktop/Portofolio/vue-pwa-webshop/src/store/cart.js"],"sourcesContent":["import { defineStore } from 'pinia'\r\nimport { ref, computed } from 'vue'\r\nimport { db } from '@/main'\r\nimport { doc, setDoc, getDoc } from 'firebase/firestore'\r\nimport { useUserStore } from './user'\r\n\r\nexport const useCartStore = defineStore('cart', () => {\r\n  const items = ref([])\r\n  const loading = ref(false)\r\n\r\n  const itemsCount = computed(() =>\r\n    items.value.reduce((total, item) => total + (item.quantity || 0), 0)\r\n  )\r\n\r\n  const subtotal = computed(() =>\r\n    items.value.reduce((total, item) => total + (item.price || 0) * (item.quantity || 0), 0)\r\n  )\r\n\r\n  const tax = computed(() => subtotal.value * 0.08)\r\n  const shipping = computed(() => (subtotal.value > 50 ? 0 : 10))\r\n  const total = computed(() => subtotal.value + tax.value + shipping.value)\r\n\r\n  const saveCartLocally = () => {\r\n    try {\r\n      localStorage.setItem('cart', JSON.stringify(items.value))\r\n    } catch (e) {\r\n      console.error('Error saving cart locally:', e)\r\n    }\r\n  }\r\n\r\n  const loadCart = async () => {\r\n    const userStore = useUserStore()\r\n\r\n    // Try to load from localStorage first\r\n    const localCart = localStorage.getItem('cart')\r\n    if (localCart) items.value = JSON.parse(localCart)\r\n\r\n    // If authenticated, sync with Firestore\r\n    if (userStore.isAuthenticated && userStore.user) {\r\n      try {\r\n        loading.value = true\r\n        const cartDoc = await getDoc(doc(db, 'carts', userStore.user.uid))\r\n        if (cartDoc.exists()) {\r\n          items.value = cartDoc.data().items || []\r\n          saveCartLocally()\r\n        }\r\n      } catch (error) {\r\n        console.error('Error loading cart from Firestore:', error)\r\n      } finally {\r\n        loading.value = false\r\n      }\r\n    }\r\n  }\r\n\r\n  const saveCart = async () => {\r\n    const userStore = useUserStore()\r\n    // Save to localStorage first\r\n    saveCartLocally()\r\n\r\n    // Save to Firestore if authenticated\r\n    if (userStore.isAuthenticated && userStore.user) {\r\n      try {\r\n        await setDoc(doc(db, 'carts', userStore.user.uid), {\r\n          items: items.value,\r\n          updatedAt: new Date().toISOString(),\r\n        })\r\n      } catch (error) {\r\n        console.error('Error saving cart to Firestore:', error)\r\n      }\r\n    }\r\n  }\r\n\r\n  const addItem = async (product) => {\r\n    const existingItem = items.value.find((item) => item.id === product.id)\r\n    if (existingItem) {\r\n      existingItem.quantity = (existingItem.quantity || 0) + 1\r\n    } else {\r\n      items.value.push({\r\n        id: product.id,\r\n        title: product.title,\r\n        price: product.price,\r\n        image: product.image,\r\n        quantity: 1,\r\n        category: product.category,\r\n      })\r\n    }\r\n\r\n    saveCartLocally()\r\n    await saveCart()\r\n    await addToHistory(product)\r\n    return { success: true }\r\n  }\r\n\r\n  const updateQuantity = async (productId, quantity) => {\r\n    const item = items.value.find((item) => item.id === productId)\r\n    if (item) {\r\n      if (quantity <= 0) {\r\n        await removeItem(productId)\r\n      } else {\r\n        item.quantity = quantity\r\n        await saveCart()\r\n      }\r\n    }\r\n  }\r\n\r\n  const removeItem = async (productId) => {\r\n    const index = items.value.findIndex((item) => item.id === productId)\r\n    if (index > -1) {\r\n      items.value.splice(index, 1)\r\n      await saveCart()\r\n    }\r\n  }\r\n\r\n  const clearCart = async () => {\r\n    items.value = []\r\n    await saveCart()\r\n  }\r\n\r\n  const addToHistory = async (product) => {\r\n    const userStore = useUserStore()\r\n    if (!userStore.isAuthenticated || !userStore.user) return\r\n\r\n    try {\r\n      const history = {\r\n        productId: product.id,\r\n        productTitle: product.title,\r\n        productPrice: product.price,\r\n        action: 'added_to_cart',\r\n        timestamp: new Date().toISOString(),\r\n        userId: userStore.user.uid,\r\n      }\r\n\r\n      await setDoc(doc(db, 'history', `${userStore.user.uid}_${Date.now()}`), history)\r\n    } catch (error) {\r\n      console.error('Error adding to history:', error)\r\n    }\r\n  }\r\n\r\n  const getRecommendations = computed(() => {\r\n    const categories = [...new Set(items.value.map((item) => item.category).filter(Boolean))]\r\n    return categories\r\n  })\r\n\r\n  return {\r\n    items,\r\n    loading,\r\n    itemsCount,\r\n    subtotal,\r\n    tax,\r\n    shipping,\r\n    total,\r\n    loadCart,\r\n    addItem,\r\n    updateQuantity,\r\n    removeItem,\r\n    clearCart,\r\n    getRecommendations,\r\n  }\r\n})\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}