{"ast":null,"code":"import { defineStore } from 'pinia';\nimport { ref, computed } from 'vue';\nimport { auth, db } from '@/main';\nimport { doc, getDoc, setDoc, updateDoc } from 'firebase/firestore';\nimport { onAuthStateChanged } from 'firebase/auth';\nexport const useUserStore = defineStore('user', () => {\n  const user = ref(null);\n  const userData = ref(null);\n  const loading = ref(false);\n  const error = ref(null);\n  const isAuthenticated = computed(() => !!user.value);\n  const displayName = computed(() => userData.value?.displayName || user.value?.email?.split('@')[0] || 'User');\n  const checkAuth = () => {\n    loading.value = true;\n    onAuthStateChanged(auth, async firebaseUser => {\n      if (firebaseUser) {\n        user.value = firebaseUser;\n        await loadUserData(firebaseUser.uid);\n      } else {\n        user.value = null;\n        userData.value = null;\n      }\n      loading.value = false;\n    });\n  };\n  const loadUserData = async uid => {\n    try {\n      const userDoc = await getDoc(doc(db, 'users', uid));\n      if (userDoc.exists()) {\n        userData.value = userDoc.data();\n      } else {\n        // Create user document if it doesn't exist\n        const newUserData = {\n          email: user.value.email,\n          displayName: user.value.displayName || user.value.email.split('@')[0],\n          createdAt: new Date().toISOString(),\n          preferences: {\n            notifications: true,\n            newsletter: false,\n            theme: 'light'\n          },\n          addresses: [],\n          paymentMethods: []\n        };\n        await setDoc(doc(db, 'users', uid), newUserData);\n        userData.value = newUserData;\n      }\n    } catch (err) {\n      console.error('Error loading user data:', err);\n      error.value = err.message;\n    }\n  };\n  const updateProfile = async profileData => {\n    if (!user.value) return;\n    try {\n      loading.value = true;\n      await updateDoc(doc(db, 'users', user.value.uid), profileData);\n      userData.value = {\n        ...userData.value,\n        ...profileData\n      };\n      return {\n        success: true\n      };\n    } catch (err) {\n      console.error('Error updating profile:', err);\n      error.value = err.message;\n      return {\n        success: false,\n        error: err.message\n      };\n    } finally {\n      loading.value = false;\n    }\n  };\n  const addAddress = async address => {\n    if (!user.value || !userData.value) return;\n    const addresses = userData.value.addresses || [];\n    addresses.push({\n      id: Date.now().toString(),\n      ...address\n    });\n    return updateProfile({\n      addresses\n    });\n  };\n  const removeAddress = async addressId => {\n    if (!user.value || !userData.value) return;\n    const addresses = userData.value.addresses.filter(a => a.id !== addressId);\n    return updateProfile({\n      addresses\n    });\n  };\n  const updatePreferences = async preferences => {\n    if (!user.value) return;\n    return updateProfile({\n      preferences: {\n        ...userData.value.preferences,\n        ...preferences\n      }\n    });\n  };\n  const logout = () => {\n    user.value = null;\n    userData.value = null;\n  };\n  return {\n    user,\n    userData,\n    loading,\n    error,\n    isAuthenticated,\n    displayName,\n    checkAuth,\n    updateProfile,\n    addAddress,\n    removeAddress,\n    updatePreferences,\n    logout\n  };\n});","map":{"version":3,"names":["defineStore","ref","computed","auth","db","doc","getDoc","setDoc","updateDoc","onAuthStateChanged","useUserStore","user","userData","loading","error","isAuthenticated","value","displayName","email","split","checkAuth","firebaseUser","loadUserData","uid","userDoc","exists","data","newUserData","createdAt","Date","toISOString","preferences","notifications","newsletter","theme","addresses","paymentMethods","err","console","message","updateProfile","profileData","success","addAddress","address","push","id","now","toString","removeAddress","addressId","filter","a","updatePreferences","logout"],"sources":["C:/Users/veszi/Desktop/Portofolio/vue-pwa-webshop/src/store/user.js"],"sourcesContent":["import { defineStore } from 'pinia'\r\nimport { ref, computed } from 'vue'\r\nimport { auth, db } from '@/main'\r\nimport { doc, getDoc, setDoc, updateDoc } from 'firebase/firestore'\r\nimport { onAuthStateChanged } from 'firebase/auth'\r\n\r\nexport const useUserStore = defineStore('user', () => {\r\n  const user = ref(null)\r\n  const userData = ref(null)\r\n  const loading = ref(false)\r\n  const error = ref(null)\r\n\r\n  const isAuthenticated = computed(() => !!user.value)\r\n  const displayName = computed(() => userData.value?.displayName || user.value?.email?.split('@')[0] || 'User')\r\n\r\n  const checkAuth = () => {\r\n    loading.value = true\r\n    onAuthStateChanged(auth, async (firebaseUser) => {\r\n      if (firebaseUser) {\r\n        user.value = firebaseUser\r\n        await loadUserData(firebaseUser.uid)\r\n      } else {\r\n        user.value = null\r\n        userData.value = null\r\n      }\r\n      loading.value = false\r\n    })\r\n  }\r\n\r\n  const loadUserData = async (uid) => {\r\n    try {\r\n      const userDoc = await getDoc(doc(db, 'users', uid))\r\n      if (userDoc.exists()) {\r\n        userData.value = userDoc.data()\r\n      } else {\r\n        // Create user document if it doesn't exist\r\n        const newUserData = {\r\n          email: user.value.email,\r\n          displayName: user.value.displayName || user.value.email.split('@')[0],\r\n          createdAt: new Date().toISOString(),\r\n          preferences: {\r\n            notifications: true,\r\n            newsletter: false,\r\n            theme: 'light'\r\n          },\r\n          addresses: [],\r\n          paymentMethods: []\r\n        }\r\n        await setDoc(doc(db, 'users', uid), newUserData)\r\n        userData.value = newUserData\r\n      }\r\n    } catch (err) {\r\n      console.error('Error loading user data:', err)\r\n      error.value = err.message\r\n    }\r\n  }\r\n\r\n  const updateProfile = async (profileData) => {\r\n    if (!user.value) return\r\n    \r\n    try {\r\n      loading.value = true\r\n      await updateDoc(doc(db, 'users', user.value.uid), profileData)\r\n      userData.value = { ...userData.value, ...profileData }\r\n      return { success: true }\r\n    } catch (err) {\r\n      console.error('Error updating profile:', err)\r\n      error.value = err.message\r\n      return { success: false, error: err.message }\r\n    } finally {\r\n      loading.value = false\r\n    }\r\n  }\r\n\r\n  const addAddress = async (address) => {\r\n    if (!user.value || !userData.value) return\r\n    \r\n    const addresses = userData.value.addresses || []\r\n    addresses.push({\r\n      id: Date.now().toString(),\r\n      ...address\r\n    })\r\n    \r\n    return updateProfile({ addresses })\r\n  }\r\n\r\n  const removeAddress = async (addressId) => {\r\n    if (!user.value || !userData.value) return\r\n    \r\n    const addresses = userData.value.addresses.filter(a => a.id !== addressId)\r\n    return updateProfile({ addresses })\r\n  }\r\n\r\n  const updatePreferences = async (preferences) => {\r\n    if (!user.value) return\r\n    \r\n    return updateProfile({ \r\n      preferences: { ...userData.value.preferences, ...preferences }\r\n    })\r\n  }\r\n\r\n  const logout = () => {\r\n    user.value = null\r\n    userData.value = null\r\n  }\r\n\r\n  return {\r\n    user,\r\n    userData,\r\n    loading,\r\n    error,\r\n    isAuthenticated,\r\n    displayName,\r\n    checkAuth,\r\n    updateProfile,\r\n    addAddress,\r\n    removeAddress,\r\n    updatePreferences,\r\n    logout\r\n  }\r\n})\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}