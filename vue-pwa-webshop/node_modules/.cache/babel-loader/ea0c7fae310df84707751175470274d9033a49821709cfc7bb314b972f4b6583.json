{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport { defineStore } from 'pinia';\nimport { ref, computed } from 'vue';\nimport { db } from '@/main';\nimport { collection, query, where, orderBy, limit, getDocs, addDoc, updateDoc, doc } from 'firebase/firestore';\nimport { useUserStore } from './user';\nexport const useNotificationStore = defineStore('notifications', () => {\n  const notifications = ref([]);\n  const loading = ref(false);\n  const unreadCount = computed(() => notifications.value.filter(n => !n.read).length);\n  const loadNotifications = async () => {\n    const userStore = useUserStore();\n    if (!userStore.isAuthenticated || !userStore.user) return;\n    try {\n      loading.value = true;\n      const q = query(collection(db, 'notifications'), where('userId', '==', userStore.user.uid), orderBy('timestamp', 'desc'), limit(50));\n      const querySnapshot = await getDocs(q);\n      notifications.value = [];\n      querySnapshot.forEach(doc => {\n        notifications.value.push({\n          id: doc.id,\n          ...doc.data()\n        });\n      });\n    } catch (error) {\n      console.error('Error loading notifications:', error);\n    } finally {\n      loading.value = false;\n    }\n  };\n  const addNotification = async notification => {\n    const userStore = useUserStore();\n    if (!userStore.isAuthenticated || !userStore.user) return;\n    try {\n      const newNotification = {\n        userId: userStore.user.uid,\n        title: notification.title,\n        message: notification.message,\n        type: notification.type || 'info',\n        read: false,\n        timestamp: new Date().toISOString(),\n        data: notification.data || {}\n      };\n      const docRef = await addDoc(collection(db, 'notifications'), newNotification);\n      notifications.value.unshift({\n        id: docRef.id,\n        ...newNotification\n      });\n      if ('Notification' in window && Notification.permission === 'granted') {\n        new Notification(notification.title, {\n          body: notification.message,\n          icon: '/img/icons/android-chrome-192x192.png',\n          badge: '/img/icons/android-chrome-192x192.png',\n          tag: docRef.id\n        });\n      }\n    } catch (error) {\n      console.error('Error adding notification:', error);\n    }\n  };\n  const markAsRead = async notificationId => {\n    const notification = notifications.value.find(n => n.id === notificationId);\n    if (notification) {\n      notification.read = true;\n      try {\n        await updateDoc(doc(db, 'notifications', notificationId), {\n          read: true\n        });\n      } catch (error) {\n        console.error('Error marking notification as read:', error);\n      }\n    }\n  };\n  const markAllAsRead = async () => {\n    const unreadNotifications = notifications.value.filter(n => !n.read);\n    for (const notification of unreadNotifications) {\n      notification.read = true;\n      try {\n        await updateDoc(doc(db, 'notifications', notification.id), {\n          read: true\n        });\n      } catch (error) {\n        console.error('Error marking notification as read:', error);\n      }\n    }\n  };\n  const clearAll = () => {\n    notifications.value = [];\n  };\n  return {\n    notifications,\n    loading,\n    unreadCount,\n    loadNotifications,\n    addNotification,\n    markAsRead,\n    markAllAsRead,\n    clearAll\n  };\n});","map":{"version":3,"names":["defineStore","ref","computed","db","collection","query","where","orderBy","limit","getDocs","addDoc","updateDoc","doc","useUserStore","useNotificationStore","notifications","loading","unreadCount","value","filter","n","read","length","loadNotifications","userStore","isAuthenticated","user","q","uid","querySnapshot","forEach","push","id","data","error","console","addNotification","notification","newNotification","userId","title","message","type","timestamp","Date","toISOString","docRef","unshift","window","Notification","permission","body","icon","badge","tag","markAsRead","notificationId","find","markAllAsRead","unreadNotifications","clearAll"],"sources":["C:/Users/veszi/Desktop/Portofolio/vue-pwa-webshop/src/store/notifications.js"],"sourcesContent":["import { defineStore } from 'pinia'\r\nimport { ref, computed } from 'vue'\r\nimport { db } from '@/main'\r\nimport { collection, query, where, orderBy, limit, getDocs, addDoc, updateDoc, doc } from 'firebase/firestore'\r\nimport { useUserStore } from './user'\r\n\r\nexport const useNotificationStore = defineStore('notifications', () => {\r\n  const notifications = ref([])\r\n  const loading = ref(false)\r\n  \r\n  const unreadCount = computed(() => \r\n    notifications.value.filter(n => !n.read).length\r\n  )\r\n\r\n  const loadNotifications = async () => {\r\n    const userStore = useUserStore()\r\n    \r\n    if (!userStore.isAuthenticated || !userStore.user) return\r\n    \r\n    try {\r\n      loading.value = true\r\n      const q = query(\r\n        collection(db, 'notifications'),\r\n        where('userId', '==', userStore.user.uid),\r\n        orderBy('timestamp', 'desc'),\r\n        limit(50)\r\n      )\r\n      \r\n      const querySnapshot = await getDocs(q)\r\n      notifications.value = []\r\n      \r\n      querySnapshot.forEach((doc) => {\r\n        notifications.value.push({\r\n          id: doc.id,\r\n          ...doc.data()\r\n        })\r\n      })\r\n    } catch (error) {\r\n      console.error('Error loading notifications:', error)\r\n    } finally {\r\n      loading.value = false\r\n    }\r\n  }\r\n\r\n  const addNotification = async (notification) => {\r\n    const userStore = useUserStore()\r\n    \r\n    if (!userStore.isAuthenticated || !userStore.user) return\r\n    \r\n    try {\r\n      const newNotification = {\r\n        userId: userStore.user.uid,\r\n        title: notification.title,\r\n        message: notification.message,\r\n        type: notification.type || 'info',\r\n        read: false,\r\n        timestamp: new Date().toISOString(),\r\n        data: notification.data || {}\r\n      }\r\n      \r\n      const docRef = await addDoc(collection(db, 'notifications'), newNotification)\r\n      \r\n      notifications.value.unshift({\r\n        id: docRef.id,\r\n        ...newNotification\r\n      })\r\n      \r\n  if ('Notification' in window && Notification.permission === 'granted') {\r\n        new Notification(notification.title, {\r\n          body: notification.message,\r\n          icon: '/img/icons/android-chrome-192x192.png',\r\n          badge: '/img/icons/android-chrome-192x192.png',\r\n          tag: docRef.id\r\n        })\r\n      }\r\n    } catch (error) {\r\n      console.error('Error adding notification:', error)\r\n    }\r\n  }\r\n\r\n  const markAsRead = async (notificationId) => {\r\n    const notification = notifications.value.find(n => n.id === notificationId)\r\n    \r\n    if (notification) {\r\n      notification.read = true\r\n      \r\n      try {\r\n        await updateDoc(doc(db, 'notifications', notificationId), {\r\n          read: true\r\n        })\r\n      } catch (error) {\r\n        console.error('Error marking notification as read:', error)\r\n      }\r\n    }\r\n  }\r\n\r\n  const markAllAsRead = async () => {\r\n    const unreadNotifications = notifications.value.filter(n => !n.read)\r\n    \r\n    for (const notification of unreadNotifications) {\r\n      notification.read = true\r\n      \r\n      try {\r\n        await updateDoc(doc(db, 'notifications', notification.id), {\r\n          read: true\r\n        })\r\n      } catch (error) {\r\n        console.error('Error marking notification as read:', error)\r\n      }\r\n    }\r\n  }\r\n\r\n  const clearAll = () => {\r\n    notifications.value = []\r\n  }\r\n\r\n  return {\r\n    notifications,\r\n    loading,\r\n    unreadCount,\r\n    loadNotifications,\r\n    addNotification,\r\n    markAsRead,\r\n    markAllAsRead,\r\n    clearAll\r\n  }\r\n})\r\n"],"mappings":";;;;;AAAA,SAASA,WAAW,QAAQ,OAAO;AACnC,SAASC,GAAG,EAAEC,QAAQ,QAAQ,KAAK;AACnC,SAASC,EAAE,QAAQ,QAAQ;AAC3B,SAASC,UAAU,EAAEC,KAAK,EAAEC,KAAK,EAAEC,OAAO,EAAEC,KAAK,EAAEC,OAAO,EAAEC,MAAM,EAAEC,SAAS,EAAEC,GAAG,QAAQ,oBAAoB;AAC9G,SAASC,YAAY,QAAQ,QAAQ;AAErC,OAAO,MAAMC,oBAAoB,GAAGd,WAAW,CAAC,eAAe,EAAE,MAAM;EACrE,MAAMe,aAAa,GAAGd,GAAG,CAAC,EAAE,CAAC;EAC7B,MAAMe,OAAO,GAAGf,GAAG,CAAC,KAAK,CAAC;EAE1B,MAAMgB,WAAW,GAAGf,QAAQ,CAAC,MAC3Ba,aAAa,CAACG,KAAK,CAACC,MAAM,CAACC,CAAC,IAAI,CAACA,CAAC,CAACC,IAAI,CAAC,CAACC,MAC3C,CAAC;EAED,MAAMC,iBAAiB,GAAG,MAAAA,CAAA,KAAY;IACpC,MAAMC,SAAS,GAAGX,YAAY,CAAC,CAAC;IAEhC,IAAI,CAACW,SAAS,CAACC,eAAe,IAAI,CAACD,SAAS,CAACE,IAAI,EAAE;IAEnD,IAAI;MACFV,OAAO,CAACE,KAAK,GAAG,IAAI;MACpB,MAAMS,CAAC,GAAGtB,KAAK,CACbD,UAAU,CAACD,EAAE,EAAE,eAAe,CAAC,EAC/BG,KAAK,CAAC,QAAQ,EAAE,IAAI,EAAEkB,SAAS,CAACE,IAAI,CAACE,GAAG,CAAC,EACzCrB,OAAO,CAAC,WAAW,EAAE,MAAM,CAAC,EAC5BC,KAAK,CAAC,EAAE,CACV,CAAC;MAED,MAAMqB,aAAa,GAAG,MAAMpB,OAAO,CAACkB,CAAC,CAAC;MACtCZ,aAAa,CAACG,KAAK,GAAG,EAAE;MAExBW,aAAa,CAACC,OAAO,CAAElB,GAAG,IAAK;QAC7BG,aAAa,CAACG,KAAK,CAACa,IAAI,CAAC;UACvBC,EAAE,EAAEpB,GAAG,CAACoB,EAAE;UACV,GAAGpB,GAAG,CAACqB,IAAI,CAAC;QACd,CAAC,CAAC;MACJ,CAAC,CAAC;IACJ,CAAC,CAAC,OAAOC,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,8BAA8B,EAAEA,KAAK,CAAC;IACtD,CAAC,SAAS;MACRlB,OAAO,CAACE,KAAK,GAAG,KAAK;IACvB;EACF,CAAC;EAED,MAAMkB,eAAe,GAAG,MAAOC,YAAY,IAAK;IAC9C,MAAMb,SAAS,GAAGX,YAAY,CAAC,CAAC;IAEhC,IAAI,CAACW,SAAS,CAACC,eAAe,IAAI,CAACD,SAAS,CAACE,IAAI,EAAE;IAEnD,IAAI;MACF,MAAMY,eAAe,GAAG;QACtBC,MAAM,EAAEf,SAAS,CAACE,IAAI,CAACE,GAAG;QAC1BY,KAAK,EAAEH,YAAY,CAACG,KAAK;QACzBC,OAAO,EAAEJ,YAAY,CAACI,OAAO;QAC7BC,IAAI,EAAEL,YAAY,CAACK,IAAI,IAAI,MAAM;QACjCrB,IAAI,EAAE,KAAK;QACXsB,SAAS,EAAE,IAAIC,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC;QACnCZ,IAAI,EAAEI,YAAY,CAACJ,IAAI,IAAI,CAAC;MAC9B,CAAC;MAED,MAAMa,MAAM,GAAG,MAAMpC,MAAM,CAACN,UAAU,CAACD,EAAE,EAAE,eAAe,CAAC,EAAEmC,eAAe,CAAC;MAE7EvB,aAAa,CAACG,KAAK,CAAC6B,OAAO,CAAC;QAC1Bf,EAAE,EAAEc,MAAM,CAACd,EAAE;QACb,GAAGM;MACL,CAAC,CAAC;MAEN,IAAI,cAAc,IAAIU,MAAM,IAAIC,YAAY,CAACC,UAAU,KAAK,SAAS,EAAE;QACjE,IAAID,YAAY,CAACZ,YAAY,CAACG,KAAK,EAAE;UACnCW,IAAI,EAAEd,YAAY,CAACI,OAAO;UAC1BW,IAAI,EAAE,uCAAuC;UAC7CC,KAAK,EAAE,uCAAuC;UAC9CC,GAAG,EAAER,MAAM,CAACd;QACd,CAAC,CAAC;MACJ;IACF,CAAC,CAAC,OAAOE,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,4BAA4B,EAAEA,KAAK,CAAC;IACpD;EACF,CAAC;EAED,MAAMqB,UAAU,GAAG,MAAOC,cAAc,IAAK;IAC3C,MAAMnB,YAAY,GAAGtB,aAAa,CAACG,KAAK,CAACuC,IAAI,CAACrC,CAAC,IAAIA,CAAC,CAACY,EAAE,KAAKwB,cAAc,CAAC;IAE3E,IAAInB,YAAY,EAAE;MAChBA,YAAY,CAAChB,IAAI,GAAG,IAAI;MAExB,IAAI;QACF,MAAMV,SAAS,CAACC,GAAG,CAACT,EAAE,EAAE,eAAe,EAAEqD,cAAc,CAAC,EAAE;UACxDnC,IAAI,EAAE;QACR,CAAC,CAAC;MACJ,CAAC,CAAC,OAAOa,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,qCAAqC,EAAEA,KAAK,CAAC;MAC7D;IACF;EACF,CAAC;EAED,MAAMwB,aAAa,GAAG,MAAAA,CAAA,KAAY;IAChC,MAAMC,mBAAmB,GAAG5C,aAAa,CAACG,KAAK,CAACC,MAAM,CAACC,CAAC,IAAI,CAACA,CAAC,CAACC,IAAI,CAAC;IAEpE,KAAK,MAAMgB,YAAY,IAAIsB,mBAAmB,EAAE;MAC9CtB,YAAY,CAAChB,IAAI,GAAG,IAAI;MAExB,IAAI;QACF,MAAMV,SAAS,CAACC,GAAG,CAACT,EAAE,EAAE,eAAe,EAAEkC,YAAY,CAACL,EAAE,CAAC,EAAE;UACzDX,IAAI,EAAE;QACR,CAAC,CAAC;MACJ,CAAC,CAAC,OAAOa,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,qCAAqC,EAAEA,KAAK,CAAC;MAC7D;IACF;EACF,CAAC;EAED,MAAM0B,QAAQ,GAAGA,CAAA,KAAM;IACrB7C,aAAa,CAACG,KAAK,GAAG,EAAE;EAC1B,CAAC;EAED,OAAO;IACLH,aAAa;IACbC,OAAO;IACPC,WAAW;IACXM,iBAAiB;IACjBa,eAAe;IACfmB,UAAU;IACVG,aAAa;IACbE;EACF,CAAC;AACH,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}